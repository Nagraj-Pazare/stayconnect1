<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PG Details | StayConnect</title>
  <link rel="stylesheet" href="css/style.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
  <div id="header-placeholder"></div>

  <section class="container my-5" id="detailsWrapper">
    <p>Loading details...</p>
  </section>

  <div id="footer-placeholder"></div>

  <!-- SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script src="../config/firebaseConfig.js"></script>
  <script src="../src/js/app.js"></script>
  <script src="../src/js/utils.js"></script>
  <script src="../src/js/auth.js"></script>
  <script src="../src/js/pg.js"></script>
  <script src="../src/js/map.js"></script>
  <script>
    (async function loadComponents(){
      document.getElementById('header-placeholder').innerHTML = await fetch('../src/components/navbar.html').then(r=>r.text());
      document.getElementById('footer-placeholder').innerHTML = await fetch('../src/components/footer.html').then(r=>r.text());
    })();
  </script>

  <script>
    // Read doc id from query param ?id=DOCUMENT_ID
    const params = new URLSearchParams(window.location.search);
    const docId = params.get('id');

    async function loadDetails() {
      if (!docId) {
        document.getElementById('detailsWrapper').innerHTML = '<p>PG not specified.</p>';
        return;
      }
      try {
        const doc = await db.collection('pgs').doc(docId).get();
        if (!doc.exists) {
          document.getElementById('detailsWrapper').innerHTML = '<p>Listing not found.</p>';
          return;
        }
        const pg = doc.data();
        document.getElementById('detailsWrapper').innerHTML = `
          <div class="row">
            <div class="col-md-6">
              <img src="${pg.imageUrl || 'images/default_pg.jpg'}" alt="PG" style="width:100%;border-radius:10px;object-fit:cover;height:350px;">
            </div>
            <div class="col-md-6">
              <h2>${pg.name}</h2>
              <p><strong>Owner:</strong> ${pg.owner || 'N/A'}</p>
              <p><strong>Rent:</strong> â‚¹${pg.rent || 'N/A'}</p>
              <p><strong>Address:</strong> ${pg.address || 'N/A'}</p>
              <p><strong>Facilities:</strong> ${(pg.facilities || []).join(', ')}</p>
              <p><strong>Contact:</strong> <a href="tel:${pg.contact}">${pg.contact}</a></p>
              <a href="map.html?focus=${docId}" class="btn btn-primary mt-3">View on Map</a>
            </div>
          </div>
        `;
      } catch (err) {
        console.error(err);
        document.getElementById('detailsWrapper').innerHTML = '<p>Error loading details.</p>';
      }
    }

    // wait for db to be ready
    const waitInterval = setInterval(() => {
      if (window.db) { clearInterval(waitInterval); loadDetails(); }
    }, 150);
  </script>
</body>
</html>
